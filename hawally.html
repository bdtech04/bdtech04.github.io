<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Hawally Zone</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #10B981;
      --primary-light: #34D399;
      --primary-dark: #059669;
      --primary-gradient: linear-gradient(135deg, #10B981 0%, #34D399 100%);
      --secondary: #059669;
      --secondary-light: #10B981;
      --accent: #34D399;
      --accent-light: #6EE7B7;
      --dark: #1F2937;
      --dark-light: #374151;
      --light: #F9FAFB;
      --white: #FFFFFF;
      --gray: #9CA3AF;
      --gray-light: #E5E7EB;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --primary-shadow: 0 4px 14px 0 rgba(16, 185, 129, 0.3);
      --secondary-shadow: 0 4px 14px 0 rgba(5, 150, 105, 0.3);
      --accent-shadow: 0 4px 14px 0 rgba(52, 211, 153, 0.3);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--white);
      background-attachment: fixed;
      color: var(--dark);
      min-height: 100vh;
      padding: 0;
      padding-top: 0;
      text-align: center;
      padding-bottom: 90px; 
      position: relative;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 20% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(5, 150, 105, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 40% 40%, rgba(52, 211, 153, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }
    .glass {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-radius: 20px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      box-shadow: var(--shadow-xl);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .header {
      padding: 12px 16px;
      position: sticky;
      top: 0;
      z-index: 1000;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(10px);
    }
    .search-container {
      position: relative;
      max-width: 600px;
      margin: 0 auto;
    }
    #searchInput {
      width: 100%;
      padding: 12px 44px 12px 44px;
      font-size: 15px;
      font-weight: 500;
      border-radius: 16px;
      border: 2px solid transparent;
      outline: none;
      background: var(--white);
      color: var(--dark);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--shadow);
    }
    #searchInput::placeholder {
      color: var(--gray);
    }
    #searchInput:focus {
      box-shadow: var(--primary-shadow);
      border-color: var(--primary);
      transform: translateY(-1px);
      background: var(--white);
    }
    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 16px;
      pointer-events: none;
      transition: color 0.3s ease;
    }
    #searchInput:focus ~ .search-icon {
      color: var(--primary);
    }
    .clear-search {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--gray-light);
      border: none;
      color: var(--dark);
      cursor: pointer;
      font-size: 12px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 6px;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .clear-search.visible {
      opacity: 1;
      visibility: visible;
    }
    .clear-search:hover {
      background: var(--primary);
      color: var(--white);
      transform: translateY(-50%) scale(1.1);
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 12px 16px;
      gap: 8px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(0,0,0,0.05);
      padding-bottom: max(12px, env(safe-area-inset-bottom));
    }
    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .filter-btn {
      width: 48px;
      height: 48px;
      border-radius: 16px;
      background: var(--white);
      color: var(--dark);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      transform: translateY(0);
      border: 2px solid transparent;
    }
    
    .filter-btn.active {
      background: var(--primary-gradient);
      color: var(--white);
      box-shadow: var(--primary-shadow);
      transform: translateY(-2px);
      border-color: transparent;
    }
    
    .filter-btn:hover:not(.active) {
      transform: translateY(-2px) scale(1.05);
      box-shadow: var(--shadow-lg);
      background: var(--light);
      color: var(--primary);
    }
    
    .filter-btn i {
      font-size: 18px;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .filter-btn:active i {
      transform: scale(0.9);
    }
    
    .filter-btn.active i {
      animation: bounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .filter-btn#addNewBtn {
      background: var(--dark);
      color: var(--white);
    }
    .filter-btn#addNewBtn:hover {
      background: var(--primary);
      color: var(--white);
    }

    .location-btn {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--white);
      color: var(--dark);
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      border: 2px solid transparent;
    }
    
    .location-btn:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: var(--accent-shadow);
      background: var(--light);
      color: var(--primary);
    }
    
    .location-btn.active {
      background: var(--primary-gradient);
      color: var(--white);
      box-shadow: var(--primary-shadow);
      transform: translateY(-2px);
      border-color: transparent;
    }
    
    .location-btn.active i {
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    .welcome-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      min-height: 60vh;
      animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .welcome-icon {
      font-size: 60px;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 20px;
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .welcome-text {
      font-size: 24px;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 8px;
    }
    .welcome-subtext {
      font-size: 15px;
      color: var(--gray);
      font-weight: 500;
    }
    .loading-dots {
      display: inline-flex;
      gap: 4px;
      margin-left: 8px;
    }
    .loading-dots span {
      width: 6px;
      height: 6px;
      background: var(--primary);
      border-radius: 50%;
      animation: bounce-dots 1.4s ease-in-out infinite;
    }
    .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
    .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes bounce-dots {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-12px); }
    }
    .locations-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      padding: 16px;
      padding-bottom: 100px;
      animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      max-width: 800px;
      margin: 0 auto;
    }
    .location {
      padding: 16px;
      position: relative;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: left;
    }
    .location:hover {
      transform: translateY(-4px) scale(1.01);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
    }
    .location::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary-gradient);
      background-size: 200% 100%;
      animation: gradient-flow 3s ease infinite;
    }
    @keyframes gradient-flow {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }
    .location.nearby {
      border: 2px solid var(--primary);
      box-shadow: 0 0 30px rgba(16, 185, 129, 0.2);
    }
    .location.nearby::after {
      content: 'Near you!';
      position: absolute;
      top: 10px;
      left: 10px;
      background: var(--primary);
      color: var(--white);
      font-size: 9px;
      font-weight: 700;
      padding: 3px 8px;
      border-radius: 10px;
      animation: fadeIn 0.5s ease;
    }
    .location-info {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-bottom: 12px;
      gap: 8px;
    }
    .location-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--dark);
      text-align: center;
      padding: 8px 16px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(52, 211, 153, 0.08) 100%);
      width: 100%;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .location-distance {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 12px;
      width: 100%;
    }
    .distance-item {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
    }
    .distance-item.distance {
      background: rgba(16, 185, 129, 0.1);
      color: var(--secondary);
    }
    .distance-item.time {
      background: rgba(52, 211, 153, 0.1);
      color: var(--secondary);
    }
    .distance-item i {
      font-size: 12px;
    }
    .favorite-btn {
      background: var(--white);
      border: 2px solid var(--gray-light);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: var(--gray);
      position: absolute;
      top: 12px;
      right: 12px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }
    .favorite-btn:hover {
      transform: scale(1.1) rotate(15deg);
      border-color: var(--secondary);
      color: var(--secondary);
    }
    .favorite-btn.active {
      background: var(--secondary);
      border-color: var(--secondary);
      color: var(--white);
      animation: heartbeat 1.5s ease-in-out infinite;
    }
    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
    .action-buttons {
      display: flex;
      justify-content: center;
    }
    .copy-btn {
      position: relative;
      background: var(--dark);
      color: var(--white);
      border: none;
      border-radius: 20px;
      padding: 8px 20px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    .copy-btn:hover {
      background: var(--primary);
      transform: translateY(-2px);
      box-shadow: var(--primary-shadow);
    }
    .copy-btn.copied {
      background: var(--secondary);
      animation: success 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    @keyframes success {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 3000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }
    .modal.show {
      display: flex;
      animation: modalFadeIn 0.3s ease;
    }
    @keyframes modalFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal-content {
      background: var(--white);
      border-radius: 24px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(0, 0, 0, 0.1);
      animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: left;
    }
    @keyframes modalSlideIn {
      from { transform: translateY(20px) scale(0.95); opacity: 0; }
      to { transform: translateY(0) scale(1); opacity: 1; }
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--dark);
    }
    .close-btn {
      background: var(--gray-light);
      border: none;
      font-size: 16px;
      color: var(--dark);
      cursor: pointer;
      transition: all 0.3s;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .close-btn:hover {
      background: var(--secondary);
      color: var(--white);
      transform: rotate(90deg);
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
      font-size: 14px;
    }
    .form-group input {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 2px solid var(--gray-light);
      background: var(--light);
      color: var(--dark);
      font-size: 15px;
      transition: all 0.3s;
      font-family: inherit;
    }
    .form-group input:focus {
      border-color: var(--primary);
      background: var(--white);
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
      outline: none;
    }
    .form-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
    }
    .form-buttons button {
      padding: 10px 20px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
      font-family: inherit;
    }
    .cancel-btn {
      background: var(--gray-light);
      color: var(--dark);
    }
    .cancel-btn:hover {
      background: var(--gray);
      color: var(--white);
    }
    .submit-btn {
      background: var(--primary-gradient);
      color: var(--white);
    }
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--primary-shadow);
    }
    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: var(--dark);
      display: none;
      animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .no-results i {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
      color: var(--gray);
    }
    .no-results p {
      font-size: 16px;
      font-weight: 500;
      color: var(--gray);
    }
    .scroll-to-top {
      position: fixed;
      bottom: 100px;
      right: 16px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--primary-gradient);
      color: var(--white);
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: var(--shadow-lg);
      cursor: pointer;
      opacity: 0;
      visibility: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 999;
      border: none;
    }
    .scroll-to-top.visible {
      opacity: 1;
      visibility: visible;
    }
    .scroll-to-top:hover {
      transform: translateY(-4px);
      box-shadow: var(--primary-shadow);
    }
    #loadingSkeletons {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      padding: 16px;
      max-width: 800px;
      margin: 0 auto;
    }
    .skeleton-card {
      background: var(--white);
      border-radius: 20px;
      padding: 20px;
      box-shadow: var(--shadow-sm);
    }
    .skeleton {
      background: linear-gradient(90deg, var(--gray-light) 25%, var(--white) 50%, var(--gray-light) 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s infinite linear;
      border-radius: 8px;
      margin: 0 auto;
    }
    .skeleton-title {
      height: 20px;
      width: 60%;
      margin-bottom: 12px;
    }
    .skeleton-text {
      height: 14px;
      width: 90%;
      margin-bottom: 8px;
    }
    .skeleton-button {
      height: 32px;
      width: 100px;
      border-radius: 16px;
      margin: 12px auto 0;
    }
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    @media (min-width: 768px) {
      .header {
        padding: 20px;
      }
      .search-container {
        max-width: 700px;
      }
      .bottom-nav {
        max-width: 500px;
        left: 50%;
        transform: translateX(-50%);
        border-radius: 24px 24px 0 0;
        margin-bottom: 0;
        border: 1px solid rgba(0,0,0,0.05);
        border-bottom: none;
      }
      .locations-container, #loadingSkeletons {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 24px;
        padding: 24px;
      }
      .welcome-icon {
        font-size: 80px;
        margin-bottom: 24px;
      }
      .welcome-text {
        font-size: 32px;
      }
      .scroll-to-top {
        bottom: 40px;
        right: 40px;
        width: 50px;
        height: 50px;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="search-container">
      <div class="search-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="searchInput" placeholder="Search restaurants..." autocomplete="off">
        <button class="clear-search" id="clearSearch" aria-label="Clear search">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </header>
  
  <main>
    <div class="welcome-container" id="welcomeContainer">
      <i class="fas fa-utensils welcome-icon"></i>
      <h1 class="welcome-text">Please Wait</h1>
      <p class="welcome-subtext">
        <h5>Welcome to Hawally Zone</h5>
        <div class="loading-dots" id="initialLoadingDots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </p>
    </div>

    <div id="loadingSkeletons" style="display: none;">
      <div class="skeleton-card">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton skeleton-text"></div>
        <div class="skeleton skeleton-button"></div>
      </div>
      <div class="skeleton-card">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton skeleton-text"></div>
        <div class="skeleton skeleton-button"></div>
      </div>
      <div class="skeleton-card">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton skeleton-text"></div>
        <div class="skeleton skeleton-button"></div>
      </div>
    </div>

    <div class="locations-container" id="locationsContainer" style="display: none;"></div>

    <div class="no-results" id="no-results">
      <i class="fas fa-map-marked-alt"></i>
      <p>Please add your Favorites Restaurant</p>
    </div>
  </main>

  <div class="modal" id="addRestaurantModal">
    <div class="modal-content glass">
      <div class="modal-header">
        <h2 class="modal-title">Add New Restaurant</h2>
        <button class="close-btn" id="closeModal" aria-label="Close modal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="addRestaurantForm">
        <div class="form-group">
          <label for="restaurantName">Restaurant Name</label>
          <input type="text" id="restaurantName" placeholder="Write Restaurant Name" required>
        </div>
        <div class="form-group">
          <label for="restaurantCoords">Restaurant Code </label>
          <input type="text" id="restaurantCoords" placeholder="Write Restaurant code" required>
          <small style="color: var(--gray); font-size: 12px; margin-top: 4px; display:block;">You Cannot Delete it please write perfectly</small>
        </div>
        <div class="form-buttons">
          <button type="button" class="cancel-btn" id="cancelAdd">Cancel</button>
          <button type="submit" class="submit-btn">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal for Manual Location Entry if GPS fails -->
  <div class="modal" id="manualLocationModal">
    <div class="modal-content glass">
      <div class="modal-header">
        <h2 class="modal-title">Enter Location Manually</h2>
        <button class="close-btn" id="closeManualModal" aria-label="Close">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="manualLocationForm">
        <p style="color: var(--gray); font-size: 14px; margin-bottom: 15px;">
          GPS was blocked by your browser or failed. Please enter your current coordinates manually.
        </p>
        <div class="form-group">
          <label for="manualCoords">Your Coordinates</label>
          <input type="text" id="manualCoords" placeholder="e.g. 29.3117, 47.4818" required>
        </div>
        <div class="form-buttons">
          <button type="button" class="cancel-btn" id="cancelManual">Cancel</button>
          <button type="submit" class="submit-btn">Set Location</button>
        </div>
      </form>
    </div>
  </div>

  <button class="scroll-to-top" id="scrollToTop" aria-label="Scroll to top">
    <i class="fas fa-arrow-up"></i>
  </button>

  <nav class="bottom-nav">
    <div class="nav-item">
      <button class="filter-btn active" data-filter="all" aria-label="All locations">
        <i class="fas fa-list"></i>
      </button>
    </div>
    <div class="nav-item">
      <button class="filter-btn" data-filter="favorites" aria-label="Favorites">
        <i class="fas fa-star"></i>
      </button>
    </div>
    <div class="nav-item">
      <button class="filter-btn" id="addNewBtn" aria-label="Add new location">
        <i class="fas fa-plus"></i>
      </button>
    </div>
    <div class="nav-item">
      <button class="location-btn" id="locationBtn" aria-label="Get my location">
        <i class="fas fa-location-dot"></i>
      </button>
    </div>
  </nav>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // DOM Elements
      const searchInput = document.getElementById('searchInput');
      const clearSearchBtn = document.getElementById('clearSearch');
      const locationsContainer = document.getElementById('locationsContainer');
      const noResults = document.getElementById('no-results');
      const scrollToTopBtn = document.getElementById('scrollToTop');
      const locationBtn = document.getElementById('locationBtn');
      const filterBtns = document.querySelectorAll('.filter-btn[data-filter]');
      const loadingSkeletons = document.getElementById('loadingSkeletons');
      const welcomeContainer = document.getElementById('welcomeContainer');
      
      const addNewBtn = document.getElementById('addNewBtn');
      const addRestaurantModal = document.getElementById('addRestaurantModal');
      const closeModal = document.getElementById('closeModal');
      const cancelAdd = document.getElementById('cancelAdd');
      const addRestaurantForm = document.getElementById('addRestaurantForm');
      const restaurantNameInput = document.getElementById('restaurantName');
      const restaurantCoordsInput = document.getElementById('restaurantCoords');
      
      const manualLocationModal = document.getElementById('manualLocationModal');
      const closeManualModal = document.getElementById('closeManualModal');
      const cancelManual = document.getElementById('cancelManual');
      const manualLocationForm = document.getElementById('manualLocationForm');
      const manualCoordsInput = document.getElementById('manualCoords');
      
      // State
      let restaurants = [];
      let filteredRestaurants = [];
      let favorites = JSON.parse(localStorage.getItem('ardiya_favorites')) || [];
      let currentFilter = 'all';
      let userLocation = null;
      let locationWatchId = null;
      let locationPermissionGranted = false;
      let searchTimeout;
      
      // Constants
      const GITHUB_URL = 'https://raw.githubusercontent.com/bdtech04/Mamu/refs/heads/main/zone.json';
      const LOCATION_STORAGE_KEY = 'ardiya_user_location';
      
      function init() {
        setupEventListeners();
        
        loadSavedLocation();
        checkLocationPermission();
        
        setTimeout(() => {
            loadFromGithub();
        }, 2500);
      }

      function saveLocation(lat, lng) {
        const locationData = { latitude: lat, longitude: lng, timestamp: Date.now() };
        localStorage.setItem(LOCATION_STORAGE_KEY, JSON.stringify(locationData));
      }

      function loadSavedLocation() {
        try {
          const saved = localStorage.getItem(LOCATION_STORAGE_KEY);
          if (saved) {
            const data = JSON.parse(saved);
            const isRecent = (Date.now() - data.timestamp) < (24 * 60 * 60 * 1000);
            if (isRecent && data.latitude && data.longitude) {
              userLocation = { latitude: data.latitude, longitude: data.longitude };
              locationPermissionGranted = true;
              locationBtn.classList.add('active');
              applyFilter();
            }
          }
        } catch (e) { console.error(e); }
      }
      
      function setupEventListeners() {
        searchInput.addEventListener('input', handleSearchInput);
        searchInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') searchInput.blur();
        });
        clearSearchBtn.addEventListener('click', clearSearch);
        locationBtn.addEventListener('click', handleLocationClick);
        
        filterBtns.forEach(btn => {
          btn.addEventListener('click', handleFilter);
        });
        
        window.addEventListener('scroll', () => {
          scrollToTopBtn.classList.toggle('visible', window.pageYOffset > 300);
        });
        
        scrollToTopBtn.addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        addNewBtn.addEventListener('click', openModal);
        closeModal.addEventListener('click', closeModalHandler);
        cancelAdd.addEventListener('click', closeModalHandler);
        addRestaurantForm.addEventListener('submit', handleAddRestaurant);
        
        addRestaurantModal.addEventListener('click', (e) => {
          if (e.target === addRestaurantModal) closeModalHandler();
        });

        // Manual Location Modal
        closeManualModal.addEventListener('click', closeManualModalHandler);
        cancelManual.addEventListener('click', closeManualModalHandler);
        manualLocationForm.addEventListener('submit', handleManualLocationSubmit);
      }
      
      function handleSearchInput(e) {
        const query = e.target.value.trim();
        clearSearchBtn.classList.toggle('visible', query.length > 0);
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(handleSearch, 300);
      }
      
      function clearSearch() {
        searchInput.value = '';
        clearSearchBtn.classList.remove('visible');
        handleSearch();
        searchInput.focus();
      }
      
      function checkLocationPermission() {
        if (!window.isSecureContext) {
          console.warn("Location API requires HTTPS or localhost.");
          return;
        }
        if ("geolocation" in navigator) {
          navigator.permissions.query({ name: 'geolocation' }).then(result => {
            if (result.state === 'granted') {
              locationPermissionGranted = true;
              startLocationWatching();
            }
          }).catch(() => {});
        }
      }
      
      function handleLocationClick() {
        // 1. Check if already active
        if (locationPermissionGranted && userLocation) {
          applyFilter();
          showToast('Location already active');
          return;
        }

        // 2. CHECK SECURE CONTEXT (Chrome Fix)
        if (!window.isSecureContext && location.protocol !== 'file:') {
           // Detect if running on HTTP or file://
           const protocol = location.protocol;
           let msg = "Chrome Security Block: Location requires HTTPS.";
           if (protocol === 'file:') {
               msg = "Chrome blocks GPS on local files. Use Localhost or HTTPS.";
           }
           
           // Offer Manual Entry as Fallback
           if(confirm(msg + "\n\nDo you want to enter your location manually?")) {
               openManualModal();
           }
           return;
        }

        if (!("geolocation" in navigator)) {
          showToast('Geolocation not supported.');
          return;
        }
        
        locationBtn.disabled = true;
        const icon = locationBtn.querySelector('i');
        icon.className = 'fas fa-circle-notch fa-spin';
        
        // 3. Try High Accuracy first
        navigator.geolocation.getCurrentPosition(
          (position) => {
            handleLocationSuccess(position);
          },
          (error) => {
            // 4. Fallback: Try Low Accuracy (Works better indoors/Chrome)
            console.log("High accuracy failed, trying low accuracy...", error);
            navigator.geolocation.getCurrentPosition(
              (pos) => handleLocationSuccess(pos),
              (err) => handleLocationError(err),
              { enableHighAccuracy: false, timeout: 15000, maximumAge: 60000 }
            );
          },
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
      }

      function handleLocationSuccess(position) {
        userLocation = {
          latitude: position.coords.latitude,
          longitude: position.coords.longitude
        };
        saveLocation(userLocation.latitude, userLocation.longitude);
        
        locationPermissionGranted = true;
        locationBtn.disabled = false;
        const icon = locationBtn.querySelector('i');
        icon.className = 'fas fa-location-dot';
        locationBtn.classList.add('active');
        
        startLocationWatching();
        applyFilter();
        showToast('Location access granted');
      }
      
      function handleLocationError(error) {
        locationBtn.disabled = false;
        const icon = locationBtn.querySelector('i');
        icon.className = 'fas fa-location-dot';
        
        let msg = 'Location access failed.';
        if (error.code === error.PERMISSION_DENIED) {
          msg = 'Permission denied. Check settings.';
        } else if (error.code === error.POSITION_UNAVAILABLE) {
          msg = 'Position unavailable.';
        } else if (error.code === error.TIMEOUT) {
          msg = 'Request timed out.';
        }

        // Offer Manual Entry as fallback
        if(confirm(msg + "\n\nDo you want to enter coordinates manually?")) {
            openManualModal();
        } else {
            showToast(msg);
        }
      }

      function openManualModal() {
        manualLocationModal.classList.add('show');
        manualCoordsInput.focus();
      }

      function closeManualModalHandler() {
        manualLocationModal.classList.remove('show');
        manualLocationForm.reset();
      }

      function handleManualLocationSubmit(e) {
        e.preventDefault();
        const coords = parseCoordinates(manualCoordsInput.value);
        if(coords) {
           userLocation = { latitude: coords.latitude, longitude: coords.longitude };
           saveLocation(userLocation.latitude, userLocation.longitude);
           locationPermissionGranted = true; // Treat manual as granted
           locationBtn.classList.add('active');
           
           closeManualModalHandler();
           applyFilter();
           showToast('Manual location set successfully');
        } else {
           showToast('Invalid coordinates format.');
        }
      }
      
      function startLocationWatching() {
        if (locationWatchId !== null) {
          navigator.geolocation.clearWatch(locationWatchId);
        }
        
        locationWatchId = navigator.geolocation.watchPosition(
          (position) => {
            userLocation = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude
            };
            saveLocation(userLocation.latitude, userLocation.longitude);
          },
          () => {},
          { enableHighAccuracy: false, timeout: 15000, maximumAge: 60000 }
        );
      }
      
      function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371e3; 
        const φ1 = lat1 * Math.PI / 180;
        const φ2 = lat2 * Math.PI / 180;
        const Δφ = (lat2 - lat1) * Math.PI / 180;
        const Δλ = (lon2 - lon1) * Math.PI / 180;

        const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                Math.cos(φ1) * Math.cos(φ2) *
                Math.sin(Δλ/2) * Math.sin(Δλ/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

        return R * c;
      }
      
      function estimateTravelTime(distance) {
        return Math.ceil((distance / 1000) / 40 * 60); 
      }
      
      function parseCoordinates(coordString) {
        if (!coordString) return null;
        try {
          const parts = coordString.split(/[ ,]+/);
          const coords = parts.map(p => parseFloat(p.trim())).filter(n => !isNaN(n));
          if (coords.length >= 2) {
            return { latitude: coords[0], longitude: coords[1] };
          }
        } catch (e) { console.error(e); }
        return null;
      }
      
      function loadFromGithub() {
        welcomeContainer.style.display = 'none';
        loadingSkeletons.style.display = 'grid';
        locationsContainer.style.display = 'none';
        
        fetch(`${GITHUB_URL}?t=${new Date().getTime()}`)
          .then(response => {
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            return response.json();
          })
          .then(data => {
            if (Array.isArray(data)) {
               restaurants = data.filter(item => item.name && item.coords);
            } else {
              throw new Error('Invalid format');
            }
            loadUserRestaurants();
          })
          .catch((err) => {
            console.warn('Fetch failed, using local sample data:', err);
            restaurants = getSampleRestaurants();
            loadUserRestaurants();
          })
          .finally(() => {
            loadingSkeletons.style.display = 'none';
            locationsContainer.style.display = 'grid';
            applyFilter();
          });
      }
      
      function getSampleRestaurants() {
        return [
          { name: "Al-Manshar Mall Food Court", coords: "29.3117, 47.4818" },
          { name: "The Avenues", coords: "29.3345, 47.6578" },
          { name: "Marina Mall", coords: "29.7371, 47.9135" },
          { name: "Souk Sharq", coords: "29.667, 47.9833" },
          { name: "360 Mall", coords: "29.3225, 47.6622" },
          { name: "Sharq Market", coords: "29.3750, 47.9800" }
        ];
      }
      
      function loadUserRestaurants() {
        const userRestaurants = JSON.parse(localStorage.getItem('ardiya_user_restaurants')) || [];
        if (userRestaurants.length > 0) {
          restaurants = [...restaurants, ...userRestaurants];
        }
      }
      
      function applyFilter() {
        const query = searchInput.value.toLowerCase().trim();
        
        let baseList = currentFilter === 'favorites' 
            ? restaurants.filter(r => favorites.includes(r.name))
            : [...restaurants];
        
        let searchList = query 
            ? baseList.filter(r => r.name.toLowerCase().includes(query))
            : baseList;
        
        if (userLocation) {
          const listWithDist = searchList.map(restaurant => {
            const coords = parseCoordinates(restaurant.coords);
            if (coords) {
              const distance = calculateDistance(
                userLocation.latitude, 
                userLocation.longitude,
                coords.latitude,
                coords.longitude
              );
              const travelTime = estimateTravelTime(distance);
              return { ...restaurant, distance, travelTime };
            }
            return { ...restaurant, distance: Infinity, travelTime: null };
          });

          filteredRestaurants = listWithDist
            .filter(r => r.distance !== Infinity)
            .sort((a, b) => a.distance - b.distance);

        } else {
          filteredRestaurants = searchList.sort((a, b) => a.name.localeCompare(b.name));
        }
        
        renderRestaurants(filteredRestaurants);
      }
      
      function handleSearch() {
        applyFilter();
      }
      
      function handleFilter(e) {
        filterBtns.forEach(btn => btn.classList.remove('active'));
        e.currentTarget.classList.add('active');
        currentFilter = e.currentTarget.dataset.filter;
        applyFilter();
      }
      
      function renderRestaurants(restaurantsToRender) {
        locationsContainer.innerHTML = '';
        
        if (restaurantsToRender.length === 0) {
          noResults.style.display = 'block';
        } else {
          noResults.style.display = 'none';
          
          restaurantsToRender.slice(0, 50).forEach((restaurant) => {
            const isNearby = userLocation && restaurant.distance && restaurant.distance < 3000;
            const element = createLocationElement(restaurant, isNearby);
            locationsContainer.appendChild(element);
          });
        }
      }
      
      function createLocationElement(restaurant, isNearby) {
        const isFavorite = favorites.includes(restaurant.name);
        
        let distanceInfo = '';
        if (restaurant.distance !== null && restaurant.distance !== Infinity) {
          const distKm = (restaurant.distance / 1000).toFixed(1);
          const time = restaurant.travelTime;
          
          distanceInfo = `
            <div class="location-distance">
              <div class="distance-item distance">
                <i class="fas fa-map-marker-alt"></i>
                <span>${distKm} km</span>
              </div>
              ${time ? `
              <div class="distance-item time">
                <i class="fas fa-car"></i>
                <span>${time} min</span>
              </div>` : ''}
            </div>
          `;
        } else {
           distanceInfo = `
            <div class="location-distance">
               <div class="distance-item" style="background:var(--gray-light); color:var(--gray);">
                 <i class="fas fa-map-pin"></i>
                 <span>Enable GPS</span>
               </div>
            </div>
           `;
        }
        
        const element = document.createElement('div');
        element.className = `location glass ${isNearby ? 'nearby' : ''}`;
        element.innerHTML = `
          <button class="favorite-btn ${isFavorite ? 'active' : ''}" aria-label="Toggle favorite">
            <i class="${isFavorite ? 'fas' : 'far'} fa-star"></i>
          </button>
          <div class="location-info">
            ${distanceInfo}
            <div class="location-name">${restaurant.name}</div>
          </div>
          <div class="action-buttons">
            <button class="copy-btn" data-coords="${restaurant.coords}" aria-label="Copy coordinates">
              <i class="fas fa-copy"></i>
              <span>Copy Location</span>
            </button>
          </div>
        `;
        
        const favoriteBtn = element.querySelector('.favorite-btn');
        favoriteBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleFavorite(restaurant.name, favoriteBtn);
        });
        
        const copyBtn = element.querySelector('.copy-btn');
        copyBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          copyCoords(restaurant.coords, copyBtn);
        });
        
        return element;
      }
      
      function toggleFavorite(restaurantName, btnElement) {
        const index = favorites.indexOf(restaurantName);
        const icon = btnElement.querySelector('i');
        
        if (index === -1) {
          favorites.push(restaurantName);
          btnElement.classList.add('active');
          icon.className = 'fas fa-star';
        } else {
          favorites.splice(index, 1);
          btnElement.classList.remove('active');
          icon.className = 'far fa-star';
        }
        
        localStorage.setItem('ardiya_favorites', JSON.stringify(favorites));
        
        if (currentFilter === 'favorites') {
          applyFilter();
        }
      }
      
      function copyCoords(coords, btnElement) {
        navigator.clipboard.writeText(coords).then(() => {
          const originalContent = btnElement.innerHTML;
          
          btnElement.innerHTML = `<i class="fas fa-check"></i><span>Copied!</span>`;
          btnElement.classList.add('copied');

          setTimeout(() => {
            btnElement.innerHTML = originalContent;
            btnElement.classList.remove('copied');
          }, 2000);
        }).catch(() => {
           showToast('Failed to copy');
        });
      }

      function showToast(message, duration = 3000) {
        const toast = document.createElement('div');
        toast.textContent = message;
        toast.style.position = 'fixed';
        toast.style.bottom = '100px';
        toast.style.left = '50%';
        toast.style.transform = 'translateX(-50%)';
        toast.style.background = 'rgba(0,0,0,0.85)';
        toast.style.color = 'white';
        toast.style.padding = '12px 24px';
        toast.style.borderRadius = '30px';
        toast.style.fontSize = '14px';
        toast.style.zIndex = '4000';
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s';
        toast.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
        toast.style.maxWidth = '90%';
        toast.style.textAlign = 'center';
        
        document.body.appendChild(toast);
        
        toast.offsetHeight;
        toast.style.opacity = '1';
        
        setTimeout(() => {
          toast.style.opacity = '0';
          setTimeout(() => toast.remove(), 300);
        }, duration);
      }
      
      function openModal() {
        addRestaurantModal.classList.add('show');
        restaurantNameInput.focus();
      }
      
      function closeModalHandler() {
        addRestaurantModal.classList.remove('show');
        addRestaurantForm.reset();
      }
      
      function handleAddRestaurant(e) {
        e.preventDefault();
        
        const name = restaurantNameInput.value.trim();
        const coords = restaurantCoordsInput.value.trim();
        
        const parsedCoords = parseCoordinates(coords);
        if (!name || !parsedCoords) {
          showToast('Please enter a valid name and coordinates.');
          return;
        }
        
        const newRestaurant = { name, coords };
        restaurants.push(newRestaurant);
        
        const userRestaurants = JSON.parse(localStorage.getItem('ardiya_user_restaurants')) || [];
        userRestaurants.push(newRestaurant);
        localStorage.setItem('ardiya_user_restaurants', JSON.stringify(userRestaurants));
        
        closeModalHandler();
        showToast('Restaurant added successfully!');
        
        if (currentFilter !== 'all' || searchInput.value) {
          document.querySelector('[data-filter="all"]').click();
          clearSearch();
        } else {
          applyFilter();
        }
      }
      
      init();
    });
  </script>
</body>
</html>